<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>Tests for guards.js</title>
    <script type="text/javascript" src="jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="../guards.js"></script>
    <link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />
    <script type="text/javascript" src="qunit.js"></script>

    <script>
      $(function() {
        $("#qunit-header").html($("title").html());

        function resetGuards() {
          $.guards = new $.Guards();
        }

        function errorMsgClass() {
          return $.guards.defaults.messageClass;
        }

        function invalidClass() {
          return $.guards.defaults.invalidClass;
        }

        function errorTag() {
          return $.guards.defaults.tag;
        }

        function assertGuards(options) {
          options.expectedErrorCount = options.expectedErrorCount || 0;
          options.expectedErrorMessageCount = options.expectedErrorMessageCount || 0;
          var form = options.form;
          equals($(form).guard(), options.expectedToPass, "Form guards should fail");
          equals($(form + " :has-error").size(), options.expectedErrorCount, "Number of fields with errors");
          equals($(form + " ." + errorMsgClass()).size(), options.expectedErrorMessageCount, "Error message count");
          if (options.errorMessageLocations) {
            $.each(options.errorMessageLocations, function(i, x) {
              var errorMsg = $(form + " ." + errorMsgClass()).eq(i);
              var expectedMsg = options.errorMessages;

              if ($.isArray(expectedMsg)) {
                expectedMsg = expectedMsg[i];
              }

              equals($(x)[0], errorMsg.prev()[0], "An error message should be located after");
              equals(errorMsg.html(), expectedMsg, "The correct error message should be used");
            });
          }
        }

        function successTest(value) {
          test("with '" + value + "' entered", function() {
            $("#form1-1").val(value);
            assertGuards({
              form: "#form1",
              expectedToPass: true
            });
          });
        }

        module("general guards", { setup: function() {
          resetGuards();
          $.guard("input").using("required");
        } });

        test("errors don't stack", function() {
          $.guard("input").using("required");
          $("#form1").guard();
          equals($("#form1 ." + errorMsgClass()).size(), $("#form1 input").size(), "Error msg count");
        });

        test("errors stack if the option is enabled", function() {
          $.guard("input").using("required");
          $.guards.options.stackErrors = true;
          $("#form1").guard();
          equals($("#form1 ." + errorMsgClass()).size(), $("#form1 input").size() * 2, "Error msg count");
          equals($("#form1-1").errors().length, 2, "Error count on a single element");
        });

        test("clearing a stacked error won't remove the other error", function() {
          $.guard("input").using("required");
          $.guards.options.stackErrors = true;
          $("#form1").guard();
          $("#form1-1").errors()[0].clear();
          equals($("#form1 ." + errorMsgClass()).size(), $("#form1 input").size() * 2 - 1, "Error msg count");
          equals($("#form1 :has-error").size(), $("#form1 input").size(), "Field error count");
          equals($("#form1-1").errors().length, 1, "Error count on a single element");
          ok($("#form1-1").hasClass(invalidClass()), "Single element has error class still");
        });

        test("clearing a stacked error with a different class won't remove the other error", function() {
          $.guard("input").using("required").invalidClass("my-invalid");
          $.guards.options.stackErrors = true;
          $("#form1").guard();
          $("#form1-1").errors()[0].clear();
          equals($("#form1 ." + errorMsgClass()).size(), $("#form1 input").size() * 2 - 1, "Error msg count");
          equals($("#form1 :has-error").size(), $("#form1 input").size(), "Field error count");
          equals($("#form1-1").errors().length, 1, "Error count on a single element");
          ok(!$("#form1-1").hasClass(invalidClass()), "Single element doesn't have the default invalid error anymore");
          ok($("#form1-1").hasClass("my-invalid"), "Single element has the custom invalid error class");
        });

        test("separate Guards instances with separate defaults both work at the same time", function() {
          var other = new $.Guards();
          other.constants.notChecked = "bad";
          other.defaults.messageClass = "my-message";
          other.defaults.invalidClass = "my-invalid";
          other.defaults.tag = "p";
          other.add("input").using(function(value, element) { return $.inArray(value, ["bad", "invalid"]) == -1; });
          $("#form2").guard();
          ok($("#form2-3").hasClass(invalidClass()), "Invalid class exists for $.guards");
          ok($("#form2-3").next().hasClass(errorMsgClass()), "Error message class exists for $.guards");
          ok($("#form2-3").next().is("span"), "Error message is a span for $.guards");
          $("#form2 input").clearErrors();
          other.guard($("#form2"));
          ok($("#form2-3").hasClass("my-invalid"), "Invalid class exists for custom guards");
          ok($("#form2-3").next().hasClass("my-message"), "Error message class exists for custom guards");
          ok($("#form2-3").next().is("p"), "Error message is a p for custom guards");
        });

        test("overriding default target works", function() {
          var other = new $.Guards();
          other.constants.notChecked = "bad";
          other.defaults.target = "#form1-customTarget-before";
          other.add("input[name='group1']").using(function(value, element) { return $.inArray(value, ["bad", "invalid"]) == -1; }).message("My error message.");
          other.guard($("#form2"));
          equals($("#form1-customTarget-before").text(), "My error message.", "The error message shows up with a custom default target");
        });

        test("separate Guards can have separate defaults", function() {
          $.guards.defaults.guard = "oneRequired";
          var other = new $.Guards();
          equals($.guards.defaults.guard, "oneRequired", "Default guard");
          equals(other.defaults.guard, "required", "Other default guard");
        });

        test("only affects the form being guarded", function() {
          $("#form1").guard();
          equals($("#form1 input:has-error").size(), $("#form1 input").size(), "Form 1 error count");
          equals($("#form2 input:has-error").size(), 0, "Form 2 error count");
        });

        test("focuses the first visible errored element", function() {
          var received = false;
          $("#form1-1").hide();
          $("#form1-2").val("A value");
          $("#form1-3").focus(function() { received = true; });
          $("#form1").guard();
          equals(received, true, "The third field is focused");
          equals($("#form1 input:has-error").size(), $("#form1 input").size() - 1, "Error count");
        });

        test("removes the field's error when a keyup is detected", function() {
          $("#form1-2").val("A value");
          $("#form1").guard();
          equals($("#form1 input:has-error").size(), $("#form1 input").size() - 1, "Error count before keyup");
          $("#form1-1").keyup();
          equals($("#form1-1").errors().length, 0, "Keyuped input's error count");
          equals($("#form1 input:has-error").size(), $("#form1 input").size() - 2, "Error count after keyup");
        });

        module("radio buttons", { setup: function() {
          resetGuards();
          $.guard("input").using("required");
        } });

        test("another form's radio state with same name doesn't affect the results", function() {
          $("#form4-2,#form4-5").attr("checked", "checked");
          assertGuards({
            form: "#form2",
            expectedToPass: false,
            expectedErrorCount: 5,
            expectedErrorMessageCount: 2,
            errorMessageLocations: $("#form2-3,#form2-5"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with all groups invalid", function() {
          assertGuards({
            form: "#form2",
            expectedToPass: false,
            expectedErrorCount: 5,
            expectedErrorMessageCount: 2,
            errorMessageLocations: $("#form2-3,#form2-5"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with the first group invalid", function() {
          $("#form2-4").attr("checked", "checked");
          assertGuards({
            form: "#form2",
            expectedToPass: false,
            expectedErrorCount: 3,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form2-3"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with none invalid", function() {
          $("#form2-1,#form2-4").attr("checked", "checked");
          assertGuards({
            form: "#form2",
            expectedToPass: true
          });
        });

        test("have the errors placed after the nextSibling (where there is expected to be text)", function() {
          $("#form2").guard();
          equals($("#form2-3")[0].nextSibling.nextSibling, $("#form2-3").next("." + errorMsgClass())[0], "Error location");
        });

        module("chekboxes", { setup: function() {
          resetGuards();
          $.guard("input").using("required");
        } });

        test("with all boxes invalid", function() {
          assertGuards({
            form: "#form3",
            expectedToPass: false,
            expectedErrorCount: 3,
            expectedErrorMessageCount: 3,
            errorMessageLocations: $("#form3 input"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with the second box invalid", function() {
          $("#form3-2").attr("checked", "checked");
          assertGuards({
            form: "#form3",
            expectedToPass: false,
            expectedErrorCount: 2,
            expectedErrorMessageCount: 2,
            errorMessageLocations: $("#form3 input[id!='form3-2']"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with none invalid", function() {
          $("#form3 input").attr("checked", "checked");
          assertGuards({
            form: "#form3",
            expectedToPass: true
          });
        });

        test("have the errors placed after the nextSibling (where there is expected to be text)", function() {
          $("#form3").guard();
          equals($("#form3-1")[0].nextSibling.nextSibling, $("#form3-1").next("." + errorMsgClass())[0], "Error location");
        });

        module("forms with mixed radio buttons/checkboxes and other inputs", { setup: function() {
          resetGuards();
          $.guard("input").using("required").grouped();
        } });

        test("radio buttons have the errors placed after the last element when it isn't a radio button", function() {
          $("#form4").guard();
          equals($("#form4-7")[0].nextSibling, $("#form4 ." + errorMsgClass())[0], "Error location");
        });

        test("radio buttons have the errors placed after the nextSibling when the last element is a radio button", function() {
          $("#form5").guard();
          equals($("#form5-6")[0].nextSibling.nextSibling, $("#form5 ." + errorMsgClass())[0], "Error location");
        });

        test("checkboxes have the errors placed after the last element when it isn't a checkbox", function() {
          $("#form6").guard();
          equals($("#form6-5")[0].nextSibling, $("#form6 ." + errorMsgClass())[0], "Error location");
        });

        test("checkboxes have the errors placed after the nextSibling when the last element is a checkbox", function() {
          $("#form7").guard();
          equals($("#form7-4")[0].nextSibling.nextSibling, $("#form7 ." + errorMsgClass())[0], "Error location");
        });

        module("custom guard");

        function customGuard(value, element) {
          return $.inArray(value, ["bad", "invalid"]) == -1;
        }

        test("with custom function and no error message defined", function() {
          resetGuards();
          $.guard("input").using(customGuard);
          $("#form1-3").val("bad");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-3"),
            errorMessages: $.guards.defaults.messages.undefined
          });
        });

        test("with custom function and an error message defined", function() {
          resetGuards();
          $.guard("input").using(customGuard).message("Custom error!");
          $("#form1-3").val("bad");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-3"),
            errorMessages: "Custom error!"
          });
        });

        test("with custom function and an error tag defined", function() {
          resetGuards();
          $.guard("input").using(customGuard).tag("p").message("Custom error!");
          $.guard("input").using("required");
          $("#form1-3,#form1-2").val("bad");
          $("#form1").guard();
          equals($("." + errorMsgClass()).size(), $("#form1 input").size(), "Total error count");
          equals($("p." + errorMsgClass()).size(), 2, "Error count with the custom tag");
          equals($(errorTag() + "." + errorMsgClass()).size(), 2, "Error count with the default tag");
        });

        test("with an error target defined", function() {
          resetGuards();
          $.guard("input").using("required").target("#form1-customTarget");
          $("#form1-3").val("value");
          $("#form1").guard();
          equals($("#form1-customTarget ." + errorMsgClass()).size(), $("#form1 input").size() - 1, "Custom target error count");
        });

        test("with an error target defined via a function", function() {
          resetGuards();
          $.guard("input").using("required").target(function() { return $(this).nextAll(".custom-target:eq(1)"); });
          $("#form1-3").val("value");
          $("#form1").guard();
          equals($("#form1-customTarget-2 ." + errorMsgClass()).size(), $("#form1 input").size() - 1, "Custom target error count");
        });

        test("with an error target defined via a function that inserts the error element itself", function() {
          resetGuards();
          $.guard("#form1-4").using("required").target(function(errorElement) {
            errorElement.appendTo($(".custom-target:eq(1)"));
            return false;
          }).message("My error message.");
          $("#form1").guard();
          equals($("#form1-customTarget-before-2 ." + errorMsgClass()).size(), 1, "Custom target error count");
          equals($("#form1-customTarget-before-2").text(), "My error message.", "Error message should not be duplicated.");
        });

        test("with a selector that doesn't select anything", function() {
          resetGuards();
          $.guard(".nothing").using("required");
          $("#form1").guard();
          equals($("input:has-error").size(), 0, "Error count");
        });

        test("with a custom invalid field class", function() {
          resetGuards();
          $.guard("#form1-1").using("required").invalidClass("my-error");
          $("#form1").guard();
          ok($("#form1-1").hasClass("my-error"), "Error field has custom input class");
          ok(!$("#form1-1").hasClass(invalidClass()), "Error field doesn't have default input class");
        });

        module("oneRequired guard", { setup: function() {
          resetGuards();
          $.guard("input").using("oneRequired").grouped();
        } });

        test("with nothing entered", function() {
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: $("#form1 input").size(),
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1 input:last"),
            errorMessages: $.guards.defaults.messages.oneRequired
          });
        });

        test("with one input entered", function() {
          $("#form1-3").val("A value");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with each input entered", function() {
          $("#form1 input").val("A value");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        module("required guard", { setup: function() {
          resetGuards();
          $.guard("input").using("required");
        } });

        test("with nothing entered", function() {
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: $("#form1 input").size(),
            expectedErrorMessageCount: $("#form1 input").size(),
            errorMessageLocations: $("#form1 input"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with one input entered", function() {
          $("#form1-3").val("A value");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: $("#form1 input").size() - 1,
            expectedErrorMessageCount: $("#form1 input").size() - 1,
            errorMessageLocations: $("#form1 input[id!='form1-3']"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with 3 inputs entered", function() {
          $("#form1-1,#form1-3,#form1-4").val("A value");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-2"),
            errorMessages: $.guards.defaults.messages.required
          });
        });

        test("with each input entered", function() {
          $("#form1 input").val("A value");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        module("email guard", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("email");
        } });

        test("with nothing entered", function() {
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.email
          });
        });

        test("with 'aaa@bbb' entered", function() {
          $("#form1-1").val("aaa@bbb");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.email
          });
        });

        successTest("aaa@bbb.com");

        module("display email guard", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("email", { allowDisplay: true });
        } });

        test("with nothing entered", function() {
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.email
          });
        });

        test("with 'aaa@bbb' entered", function() {
          $("#form1-1").val("aaa@bbb");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.email
          });
        });

        successTest("aaa@bbb.com");
        successTest("<aaa@bbb.com>");
        successTest("John Doe <aaa@bbb.com>");

        module("phoneUS guard", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("phoneUS");
        } });

        test("with nothing entered", function() {
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.phoneUS
          });
        });

        test("with '123' entered", function() {
          $("#form1-1").val("123");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.phoneUS
          });
        });

        test("with '555-2345' entered", function() {
          $("#form1-1").val("555-2345");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: $.guards.defaults.messages.phoneUS
          });
        });

        successTest("408 555-2345");
        successTest("408-555-2345");
        successTest("(408) 555-2345");
        successTest("4085552345");
        successTest("14085552345");
        successTest("1-408-555-2345");
        successTest("1 (408) 555-2345");

        module("int with min 1 max 4", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("int", { min: 1, max: 4 });
        } });

        test("with '0' entered", function() {
          $("#form1-1").val("0");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1 to 4."
          });
        });

        test("with '-2' entered", function() {
          $("#form1-1").val("-2");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1 to 4."
          });
        });

        test("with '5' entered", function() {
          $("#form1-1").val("5");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1 to 4."
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1 to 4."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1 to 4."
          });
        });

        successTest("1");
        successTest("4");
        successTest("3");

        module("int with min 1", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("int", { min: 1 });
        } });

        test("with '0' entered", function() {
          $("#form1-1").val("0");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no less than 1."
          });
        });

        test("with '-2' entered", function() {
          $("#form1-1").val("-2");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no less than 1."
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no less than 1."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no less than 1."
          });
        });

        successTest("1");
        successTest("3");

        module("int with max 4", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("int", { max: 4 });
        } });

        test("with '5' entered", function() {
          $("#form1-1").val("5");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no greater than 4."
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no greater than 4."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number no greater than 4."
          });
        });

        successTest("0");
        successTest("-2");
        successTest("4");
        successTest("3");

        module("int with no min or max", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("int");
        } });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        successTest("-2");
        successTest("3");

        module("string with min 2 max 5", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("string", { min: 2, max: 5 });
        } });

        test("with '' entered", function() {
          $("#form1-1").val("");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length 2 to 5."
          });
        });

        test("with '   ' entered", function() {
          $("#form1-1").val("   ");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length 2 to 5."
          });
        });

        test("with 'a' entered", function() {
          $("#form1-1").val("a");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length 2 to 5."
          });
        });

        test("with 'abcdef' entered", function() {
          $("#form1-1").val("abcdef");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length 2 to 5."
          });
        });

        successTest("ab");
        successTest("abcde");
        successTest("abc");
        successTest("  abc  ");

        module("string with min 2", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("string", { min: 2 });
        } });

        test("with '' entered", function() {
          $("#form1-1").val("");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length at least 2."
          });
        });

        test("with '   ' entered", function() {
          $("#form1-1").val("   ");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length at least 2."
          });
        });

        test("with 'a' entered", function() {
          $("#form1-1").val("a");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length at least 2."
          });
        });

        successTest("ab");
        successTest("abc");

        module("string with max 5", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("string", { max: 5 });
        } });

        test("with 'abcdef' entered", function() {
          $("#form1-1").val("abcdef");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a string with length no greater than 5."
          });
        });

        successTest("");
        successTest("a");
        successTest("abc");
        successTest("  abc  ");
        successTest("abcde");

        module("allow with ['good', ' better', ' best ', 1, '2', '03']", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("allow", ["good", " better", " best ", 1, "2", "03"]);
        } });

        test("with 'bad' entered", function() {
          $("#form1-1").val("bad");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter one of: good, better, best, 1, 2, 03."
          });
        });

        test("with 'Good' entered", function() {
          $("#form1-1").val("Good");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter one of: good, better, best, 1, 2, 03."
          });
        });

        test("with '01' entered", function() {
          $("#form1-1").val("01");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter one of: good, better, best, 1, 2, 03."
          });
        });

        test("with '02' entered", function() {
          $("#form1-1").val("02");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter one of: good, better, best, 1, 2, 03."
          });
        });

        test("with '3' entered", function() {
          $("#form1-1").val("3");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter one of: good, better, best, 1, 2, 03."
          });
        });

        successTest("good");
        successTest("best");
        successTest("  best  ");
        successTest("1");
        successTest("2");
        successTest("03");

        module("disallow with ['bad', ' worse', ' worst ', 1, '2', '03']", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("disallow", ["bad", " worse", " worst ", 1, "2", "03"]);
        } });

        test("with 'bad' entered", function() {
          $("#form1-1").val("bad");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with ' bad' entered", function() {
          $("#form1-1").val(" bad");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with 'worse' entered", function() {
          $("#form1-1").val("worse");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with 'worst' entered", function() {
          $("#form1-1").val("worst");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with '  worst  ' entered", function() {
          $("#form1-1").val("  worst  ");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with '1' entered", function() {
          $("#form1-1").val("1");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with '2' entered", function() {
          $("#form1-1").val("2");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with '03' entered", function() {
          $("#form1-1").val("03");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please don't enter: bad, worse, worst, 1, 2, 03."
          });
        });

        test("with 'good' entered", function() {
          $("#form1-1").val("good");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        successTest("");
        successTest("Bad");
        successTest("01");
        successTest("02");
        successTest("3");

        module("float with min 1.2 max 4", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("float", { min: 1.2, max: 4 });
        } });

        test("with '0' entered", function() {
          $("#form1-1").val("0");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with '1' entered", function() {
          $("#form1-1").val("1");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with '-2' entered", function() {
          $("#form1-1").val("-2");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with '5' entered", function() {
          $("#form1-1").val("5");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number from 1.2 to 4."
          });
        });

        test("with '1.2' entered", function() {
          $("#form1-1").val("1.2");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with '4' entered", function() {
          $("#form1-1").val("4");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with '3' entered", function() {
          $("#form1-1").val("3");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        module("float with no min or max", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("float");
        } });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '-2.' entered", function() {
          $("#form1-1").val("-2.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '--1' entered", function() {
          $("#form1-1").val("--1.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '0+.2' entered", function() {
          $("#form1-1").val("0+.2.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a number."
          });
        });

        test("with '1.2' entered", function() {
          $("#form1-1").val("1.2");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with '.23' entered", function() {
          $("#form1-1").val(".23");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with '-1' entered", function() {
          $("#form1-1").val("-1");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with '-11.23' entered", function() {
          $("#form1-1").val("-11.23");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        module("moneyUS with no min or max", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("moneyUS");
        } });

        test("with 'aaa' entered", function() {
          $("#form1-1").val("aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '2aaa' entered", function() {
          $("#form1-1").val("2aaa");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '-2.' entered", function() {
          $("#form1-1").val("-2.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '--1' entered", function() {
          $("#form1-1").val("--1.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '0+.2' entered", function() {
          $("#form1-1").val("0+.2.");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '1,12,34' entered", function() {
          $("#form1-1").val("1,12,34");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '1211,234' entered", function() {
          $("#form1-1").val("1211,234");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '$-$112' entered", function() {
          $("#form1-1").val("$-$112");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '112.340' entered", function() {
          $("#form1-1").val("112.340");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        test("with '112.3401' entered", function() {
          $("#form1-1").val("112.3401");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount."
          });
        });

        successTest("");
        successTest("1,232.20");
        successTest("$10,231,232");
        successTest("1.20");
        successTest(".23");
        successTest("-1");
        successTest("-11.23");
        successTest("$1.23");
        successTest("$3");
        successTest("$.23");
        successTest("-$.23");
        successTest("$-1.23");

        module("moneyUS with min and max", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("moneyUS", { min: 12.50, max: 15 });
        } });

        test("with '$12.49' entered", function() {
          $("#form1-1").val("$12.49");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount from 12.50 to 15.00."
          });
        });

        test("with '$15.01' entered", function() {
          $("#form1-1").val("$15.01");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "Please enter a dollar amount from 12.50 to 15.00."
          });
        });

        successTest("");
        successTest("$12.50");
        successTest("$15.00");
        successTest("13");

        module("Using preconditions", { setup: function() {
          resetGuards();
          $.guard("#form1-1").using("required").precondition(function() { return $("#form1-2").val() != "abc"; });
        } });

        test("with precondition unmet and guard unmet", function() {
          $("#form1-1").val("");
          $("#form1-2").val("abc");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with precondition unmet and guard met", function() {
          $("#form1-1").val("123");
          $("#form1-2").val("abc");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });

        test("with precondition met and guard unmet", function() {
          $("#form1-1").val("");
          $("#form1-2").val("");
          assertGuards({
            form: "#form1",
            expectedToPass: false,
            expectedErrorCount: 1,
            expectedErrorMessageCount: 1,
            errorMessageLocations: $("#form1-1"),
            errorMessages: "This field is required."
          });
        });

        test("with precondition met and guard met", function() {
          $("#form1-1").val("123");
          $("#form1-2").val("");
          assertGuards({
            form: "#form1",
            expectedToPass: true
          });
        });
      });
    </script>
  </head>

  <body>
    <h1 id="qunit-header"></h1>
    <h2 id="qunit-banner"></h2>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>

    <div id="qunit-fixture">
      <form id="form1">
        <div id="form1-customTarget-before" class="custom-target"></div>
        <div id="form1-customTarget-before-2" class="custom-target"></div>
        <input id="form1-1" type="text" name="text[]" />
        <input id="form1-2" type="text" name="text[]" />
        <input id="form1-3" type="text" name="other" />
        <input id="form1-4" type="text" name="another" />
        <div id="form1-customTarget" class="custom-target"></div>
        <div id="form1-customTarget-2" class="custom-target"></div>
      </form>

      <form id="form2">
        <input id="form2-1" type="radio" name="group1" value="1" /> FirstOption 1
        <input id="form2-2" type="radio" name="group1" value="2" /> FirstOption 2
        <input id="form2-3" type="radio" name="group1" value="3" /> FirstOption 3
        <input id="form2-4" type="radio" name="group2" value="a" /> Second Option a
        <input id="form2-5" type="radio" name="group2" value="b" /> Second Option b
      </form>

      <form id="form3">
        <input id="form3-1" type="checkbox" name="box[]" value="1" /> Box 1
        <input id="form3-2" type="checkbox" name="box[]" value="2" /> Box 2
        <input id="form3-3" type="checkbox" name="other" value="3" /> Box 3
      </form>

      <form id="form4">
        <input id="form4-1" type="text" name="text" />
        <input id="form4-2" type="radio" name="group1" value="1" /> FirstOption 1
        <input id="form4-3" type="radio" name="group1" value="2" /> FirstOption 2
        <input id="form4-4" type="radio" name="group1" value="3" /> FirstOption 3
        <input id="form4-5" type="radio" name="group2" value="a" /> Second Option a
        <input id="form4-6" type="radio" name="group2" value="b" /> Second Option b
        <input id="form4-7" type="text" name="text" />
      </form>

      <form id="form5">
        <input id="form5-1" type="text" name="text" />
        <input id="form5-2" type="radio" name="group1" value="1" /> FirstOption 1
        <input id="form5-3" type="radio" name="group1" value="2" /> FirstOption 2
        <input id="form5-4" type="radio" name="group1" value="3" /> FirstOption 3
        <input id="form5-5" type="radio" name="group2" value="a" /> Second Option a
        <input id="form5-6" type="radio" name="group2" value="b" /> Second Option b
      </form>

      <form id="form6">
        <input id="form6-1" type="text" name="text" />
        <input id="form6-2" type="checkbox" name="box[]" value="1" /> Box 1
        <input id="form6-3" type="checkbox" name="box[]" value="2" /> Box 2
        <input id="form6-4" type="checkbox" name="other" value="3" /> Box 3
        <input id="form6-5" type="text" name="text" />
      </form>

      <form id="form7">
        <input id="form7-1" type="text" name="text" />
        <input id="form7-2" type="checkbox" name="box[]" value="1" /> Box 1
        <input id="form7-3" type="checkbox" name="box[]" value="2" /> Box 2
        <input id="form7-4" type="checkbox" name="other" value="3" /> Box 3
      </form>
    </div>
  </body>
</html>
